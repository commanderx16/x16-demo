100 REM MAKE TILES 4BPP
110 REM RANDALL BOHN 2019.10.12
120 GOSUB 2100 :REM RANDOM TILES
130 GOSUB 400 :REM FILL PALETTE
140 GOSUB 300 :REM SET UP LAYER ONE
150 GOSUB 200 :REM PUT TILES ON SCREEN
160 END

200 REM RANDOM TILE FILL
210 FOR X = 40 TO 79
220 FOR Y = 0 TO 31
230 TX=INT(RND(1)*4)+1
240 VPOKE 0,16*1024+256*Y+X*2, TX :REM RANDOM TILE
250 VPOKE 0,16*1024+256*Y+X*2+1, $10 :REM PALETTE SHIFT 16
260 NEXT Y
270 NEXT X
280 RETURN

300 REM SET UP L1
310 VPOKE 15,$3005,$18 :REM TILES AT 24*1024
320 VPOKE 15,$3003,$10 :REM MAP AT 16*1024
330 VPOKE 15,$3001,$0E :REM MAPH=256 MAPW=128
340 VPOKE 15,$3000,$61 :REM MODE 3 (4 BPP)
350 RETURN

400 REM FILL PALETTE 16..31
410 SLOT = $1000+32
420 FOR X = 0 TO 15
430 READ R,G,B
440 VPOKE 15, SLOT+X*2, G*16+B
450 VPOKE 15, SLOT+X*2+1, R
460 NEXT X
470 U=VPEEK(15,SLOT):VPOKE 15,$1000,U :REM COPY ENTRY 16 TO 0
480 U=VPEEK(15,SLOT+1):VPOKE 15,$1001,U
490 POKE 713,1:PRINT CHR$(147) :REM CLEAR SCREEN WITH NEW BACKGROUND
499 RETURN

1100 REM "TEMPERATURE" PALETTE
1110 DATA 0,2,3
1120 DATA 0,2,5
1130 DATA 1,3,7
1140 DATA 3,3,8
1150 DATA 5,3,9
1160 DATA 7,4,9
1170 DATA 8,5,8
1180 DATA 10,5,8
1190 DATA 11,6,7
1200 DATA 13,6,6
1210 DATA 14,7,5
1220 DATA 15,8,4
1230 DATA 15,10,4
1240 DATA 15,11,4
1250 DATA 15,13,4
1260 DATA 14,15,5
1270 DATA 15,15,10

2100 REM MAKE RANDOM TILES 1..4
2110 N=1:V=0:GOSUB 2200
2120 N=2:V=4:GOSUB 2200
2130 N=3:V=8:GOSUB 2200
2140 N=4:V=12:GOSUB 2200
2150 RETURN
2200 TN=24*1024+32*N :REM FILL TILE N
2210 FOR X = 0 TO 31
2220 CC = INT(RND(1)*4)+V
2230 CC = 255 AND (CC*16+CC) 
2240 VPOKE 0,TN+X,CC
2250 NEXT X
2260 RETURN
